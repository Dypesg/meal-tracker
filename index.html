<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Meal Tracker">
    <title>üí™ Powerbuilding Meal Tracker</title>
    
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            color: white;
            min-height: 100vh;
            overscroll-behavior: none;
        }
        .container { max-width: 640px; margin: 0 auto; padding: 1rem; padding-bottom: 6rem; }
        .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(16px); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.75rem; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(168,85,247,0.3); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: white; }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: rgba(239,68,68,0.2); color: white; }
        .progress-bar { width: 100%; height: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 1rem; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .purple-gradient { background: linear-gradient(90deg, #a855f7 0%, #ec4899 100%); }
        .green-gradient { background: linear-gradient(90deg, #10b981 0%, #34d399 100%); }
        .grid { display: grid; gap: 1rem; }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .flex { display: flex; }
        .flex-between { justify-content: space-between; align-items: center; }
        .flex-center { justify-content: center; align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .text-xl { font-size: 1.25rem; font-weight: 600; }
        .text-2xl { font-size: 1.5rem; font-weight: 700; }
        .text-3xl { font-size: 1.875rem; font-weight: 700; }
        .text-sm { font-size: 0.875rem; }
        .text-purple { color: #c084fc; }
        .text-green { color: #34d399; }
        .text-gray { color: #cbd5e1; }
        .text-red { color: #f87171; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .opacity-60 { opacity: 0.6; }
        .rounded { border-radius: 0.5rem; }
        .rounded-lg { border-radius: 0.75rem; }
        .rounded-xl { border-radius: 1rem; }
        .rounded-2xl { border-radius: 1.5rem; }
        .w-full { width: 100%; }
        input, textarea, select { 
            width: 100%; 
            padding: 0.75rem; 
            background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 0.5rem; 
            color: white;
            font-size: 1rem;
        }
        input:focus, textarea:focus { outline: none; border-color: #a855f7; }
        .tab { flex: 1; padding: 0.75rem; text-align: center; border-radius: 0.75rem; font-weight: 600; cursor: pointer; }
        .tab-active { background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; padding: 1rem; z-index: 1000; }
        .modal-content { background: #1e293b; border-radius: 1.5rem; padding: 2rem; max-width: 28rem; width: 100%; }
        .icon-btn { padding: 0.5rem; background: rgba(255,255,255,0.1); border: none; border-radius: 0.5rem; color: white; cursor: pointer; }
        .icon-btn:hover { background: rgba(255,255,255,0.2); }
        .pin-dot { width: 4rem; height: 4rem; border: 2px solid rgba(255,255,255,0.2); border-radius: 1rem; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .pin-dot-active { border-color: #a855f7; background: rgba(168,85,247,0.2); }
        .numpad-btn { background: rgba(255,255,255,0.1); border: none; border-radius: 1rem; padding: 1.5rem; font-size: 1.5rem; font-weight: 700; color: white; cursor: pointer; }
        .numpad-btn:hover { background: rgba(255,255,255,0.2); }
        .numpad-btn:active { transform: scale(0.95); }
        .error { background: rgba(239,68,68,0.2); border: 1px solid #ef4444; padding: 0.75rem; border-radius: 0.75rem; text-align: center; color: #fca5a5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const defaultMeals = [
                { id: 1, name: "Breakfast", time: "08:00", items: "4 eggs, 2 toast, 1 banana", calories: 600, protein: 35, completed: false },
                { id: 2, name: "Lunch", time: "13:00", items: "200g chicken (raw), 200g rice, veggies, 1 tbsp oil", calories: 650, protein: 50, completed: false },
                { id: 3, name: "Pre-Workout", time: "16:00", items: "Greek yogurt 200g, 1 apple", calories: 200, protein: 20, completed: false },
                { id: 4, name: "Dinner", time: "19:00", items: "200g beef/fish (raw), 150g sweet potato, salad", calories: 600, protein: 45, completed: false },
                { id: 5, name: "Evening", time: "21:00", items: "Protein shake, 20g almonds", calories: 250, protein: 30, completed: false }
            ];

            const [isLocked, setIsLocked] = useState(() => !!localStorage.getItem('appPin'));
            const [showPinSetup, setShowPinSetup] = useState(() => !localStorage.getItem('appPin'));
            const [meals, setMeals] = useState(() => JSON.parse(localStorage.getItem('meals') || JSON.stringify(defaultMeals)));
            const [weights, setWeights] = useState(() => JSON.parse(localStorage.getItem('weights') || '[]'));
            const [activeTab, setActiveTab] = useState('meals');
            const [editingMeal, setEditingMeal] = useState(null);
            const [showAddMeal, setShowAddMeal] = useState(false);
            const [showWeightLog, setShowWeightLog] = useState(false);
            const [notificationsEnabled, setNotificationsEnabled] = useState(() => localStorage.getItem('notificationsEnabled') === 'true');

            useEffect(() => { localStorage.setItem('meals', JSON.stringify(meals)); }, [meals]);
            useEffect(() => { localStorage.setItem('weights', JSON.stringify(weights)); }, [weights]);
            useEffect(() => {
                const today = new Date().toDateString();
                const lastReset = localStorage.getItem('lastReset');
                if (lastReset !== today) {
                    setMeals(meals.map(m => ({ ...m, completed: false })));
                    localStorage.setItem('lastReset', today);
                }
            }, []);

            const toggleMeal = (id) => setMeals(meals.map(m => m.id === id ? { ...m, completed: !m.completed } : m));
            const deleteMeal = (id) => setMeals(meals.filter(m => m.id !== id));
            const saveMeal = (data) => {
                if (editingMeal) {
                    setMeals(meals.map(m => m.id === editingMeal.id ? { ...data, id: editingMeal.id } : m));
                    setEditingMeal(null);
                } else {
                    setMeals([...meals, { ...data, id: Date.now() }]);
                    setShowAddMeal(false);
                }
            };
            const addWeight = (w) => setWeights([{ id: Date.now(), weight: parseFloat(w), date: new Date().toISOString() }, ...weights]);
            const deleteWeight = (id) => setWeights(weights.filter(w => w.id !== id));
            const totals = meals.reduce((acc, m) => ({ calories: acc.calories + (m.completed ? m.calories : 0), protein: acc.protein + (m.completed ? m.protein : 0) }), { calories: 0, protein: 0 });
            const requestNotifications = async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        setNotificationsEnabled(true);
                        localStorage.setItem('notificationsEnabled', 'true');
                    }
                }
            };

            if (isLocked || showPinSetup) {
                return <PinScreen isSetup={showPinSetup} onUnlock={() => { setIsLocked(false); setShowPinSetup(false); }} />;
            }

            return (
                <div className="container">
                    <div className="mb-6">
                        <h1 className="text-3xl mb-2">üí™ Powerbuilding Tracker</h1>
                        <p className="text-purple">Your Complete Nutrition Hub</p>
                    </div>

                    <div className="card flex gap-2 p-2 mb-6">
                        <div className={`tab ${activeTab === 'meals' ? 'tab-active' : ''}`} onClick={() => setActiveTab('meals')}>Meals</div>
                        <div className={`tab ${activeTab === 'progress' ? 'tab-active' : ''}`} onClick={() => setActiveTab('progress')}>Progress</div>
                    </div>

                    {activeTab === 'meals' && (
                        <>
                            <div className="card">
                                <h2 className="text-xl mb-4">Today's Progress</h2>
                                <div className="grid grid-2 gap-4">
                                    <div>
                                        <p className="text-sm text-purple mb-1">Calories</p>
                                        <p className="text-2xl mb-2">{totals.calories} / 2300</p>
                                        <div className="progress-bar"><div className="progress-fill purple-gradient" style={{ width: `${Math.min((totals.calories / 2300) * 100, 100)}%` }}></div></div>
                                    </div>
                                    <div>
                                        <p className="text-sm text-purple mb-1">Protein (g)</p>
                                        <p className="text-2xl mb-2">{totals.protein} / 210</p>
                                        <div className="progress-bar"><div className="progress-fill green-gradient" style={{ width: `${Math.min((totals.protein / 210) * 100, 100)}%` }}></div></div>
                                    </div>
                                </div>
                            </div>

                            <div className="card flex flex-between">
                                <div className="flex gap-2">
                                    <span>üîî</span>
                                    <span>Meal Reminders</span>
                                </div>
                                <button className={`btn ${notificationsEnabled ? 'btn-success' : 'btn-secondary'}`} onClick={() => notificationsEnabled ? setNotificationsEnabled(false) : requestNotifications()}>
                                    {notificationsEnabled ? 'ON' : 'OFF'}
                                </button>
                            </div>

                            <div className="mb-6">
                                {meals.sort((a, b) => a.time.localeCompare(b.time)).map(meal => (
                                    <div key={meal.id} className={`card ${meal.completed ? 'opacity-60' : ''}`}>
                                        <div className="flex flex-between">
                                            <div style={{ flex: 1 }}>
                                                <div className="flex gap-2 mb-1">
                                                    <h3 className="text-xl">{meal.name}</h3>
                                                    <span className="text-purple">{meal.time}</span>
                                                </div>
                                                <p className="text-sm text-gray mb-2">{meal.items}</p>
                                                <div className="flex gap-4 text-sm">
                                                    <span className="text-purple">{meal.calories} cal</span>
                                                    <span className="text-green">{meal.protein}g protein</span>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button className="icon-btn" onClick={() => setEditingMeal(meal)}>‚úèÔ∏è</button>
                                                <button className="icon-btn" onClick={() => deleteMeal(meal.id)}>üóëÔ∏è</button>
                                                <button className={`icon-btn ${meal.completed ? 'btn-success' : ''}`} onClick={() => toggleMeal(meal.id)}>‚úì</button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-2 gap-4">
                                <button className="btn btn-primary" onClick={() => setShowAddMeal(true)}>+ Add Meal</button>
                                <button className="btn btn-secondary" onClick={() => setMeals(meals.map(m => ({ ...m, completed: false })))}>Reset Day</button>
                            </div>
                        </>
                    )}

                    {activeTab === 'progress' && (
                        <>
                            <div className="card">
                                <div className="flex flex-between mb-4">
                                    <h2 className="text-xl">Weight Tracking</h2>
                                    <button className="btn btn-primary" onClick={() => setShowWeightLog(true)}>Log Weight</button>
                                </div>

                                {weights.length > 0 ? (
                                    <div className="grid grid-2 gap-4 mb-6">
                                        <div>
                                            <p className="text-sm text-purple mb-1">Current Weight</p>
                                            <p className="text-3xl">{weights[0].weight} kg</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-purple mb-1">Total Change</p>
                                            <p className={`text-3xl ${(weights[0].weight - weights[weights.length - 1].weight) < 0 ? 'text-green' : 'text-red'}`}>
                                                {(weights[0].weight - weights[weights.length - 1].weight).toFixed(1)} kg
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div style={{ textAlign: 'center', padding: '2rem', color: '#94a3b8' }}>
                                        <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üìâ</div>
                                        <p>No weight entries yet</p>
                                    </div>
                                )}
                            </div>

                            {weights.length > 0 && (
                                <div className="mb-6">
                                    <h3 className="text-xl mb-4">Weight History</h3>
                                    {weights.map(entry => (
                                        <div key={entry.id} className="card flex flex-between">
                                            <div>
                                                <p className="text-2xl">{entry.weight} kg</p>
                                                <p className="text-sm text-purple">{new Date(entry.date).toLocaleDateString()}</p>
                                            </div>
                                            <button className="icon-btn" onClick={() => deleteWeight(entry.id)}>üóëÔ∏è</button>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="card">
                                <h3 className="text-xl mb-4">12-Week Goals</h3>
                                <div className="flex flex-between mb-2">
                                    <span className="text-gray">Target Loss</span>
                                    <span style={{ fontWeight: 600 }}>6-10 kg</span>
                                </div>
                                <div className="flex flex-between mb-2">
                                    <span className="text-gray">Weekly Target</span>
                                    <span style={{ fontWeight: 600 }}>-0.5 to -1 kg</span>
                                </div>
                                <div className="flex flex-between">
                                    <span className="text-gray">Goal Weight</span>
                                    <span style={{ fontWeight: 600 }}>95-99 kg</span>
                                </div>
                            </div>
                        </>
                    )}

                    {(editingMeal || showAddMeal) && <MealForm meal={editingMeal} onSave={saveMeal} onCancel={() => { setEditingMeal(null); setShowAddMeal(false); }} />}
                    {showWeightLog && <WeightForm onSave={addWeight} onCancel={() => setShowWeightLog(false)} />}
                </div>
            );
        };

        const PinScreen = ({ isSetup, onUnlock }) => {
            const [pin, setPin] = useState('');
            const [confirmPin, setConfirmPin] = useState('');
            const [step, setStep] = useState(isSetup ? 'setup' : 'enter');
            const [error, setError] = useState('');

            const handleInput = (digit) => {
                if (step === 'setup' && pin.length < 4) {
                    const newPin = pin + digit;
                    setPin(newPin);
                    if (newPin.length === 4) setStep('confirm');
                } else if (step === 'confirm' && confirmPin.length < 4) {
                    const newConfirm = confirmPin + digit;
                    setConfirmPin(newConfirm);
                    if (newConfirm.length === 4) {
                        if (newConfirm === pin) {
                            localStorage.setItem('appPin', pin);
                            onUnlock();
                        } else {
                            setError('PINs do not match');
                            setTimeout(() => { setPin(''); setConfirmPin(''); setStep('setup'); setError(''); }, 1500);
                        }
                    }
                } else if (step === 'enter' && pin.length < 4) {
                    const newPin = pin + digit;
                    setPin(newPin);
                    if (newPin.length === 4) {
                        if (newPin === localStorage.getItem('appPin')) {
                            onUnlock();
                        } else {
                            setError('Incorrect PIN');
                            setTimeout(() => { setPin(''); setError(''); }, 1500);
                        }
                    }
                }
            };

            const currentPin = step === 'confirm' ? confirmPin : pin;

            return (
                <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem' }}>
                    <div style={{ maxWidth: '28rem', width: '100%' }}>
                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üîí</div>
                            <h2 className="text-2xl mb-2">{step === 'setup' ? 'Create PIN' : step === 'confirm' ? 'Confirm PIN' : 'Enter PIN'}</h2>
                            <p className="text-purple">{step === 'setup' ? 'Create a 4-digit PIN' : step === 'confirm' ? 'Re-enter your PIN' : 'Enter PIN to unlock'}</p>
                        </div>

                        {error && <div className="error mb-4">{error}</div>}

                        <div className="flex flex-center gap-4 mb-6">
                            {[0, 1, 2, 3].map(i => (
                                <div key={i} className={`pin-dot ${currentPin[i] ? 'pin-dot-active' : ''}`}>
                                    {currentPin[i] ? '‚óè' : ''}
                                </div>
                            ))}
                        </div>

                        <div className="grid grid-3 gap-4">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(d => (
                                <button key={d} className="numpad-btn" onClick={() => handleInput(d.toString())}>{d}</button>
                            ))}
                            <div></div>
                            <button className="numpad-btn" onClick={() => handleInput('0')}>0</button>
                            <button className="numpad-btn" onClick={() => step === 'confirm' ? setConfirmPin(confirmPin.slice(0, -1)) : setPin(pin.slice(0, -1))}>‚Üê</button>
                        </div>
                    </div>
                </div>
            );
        };

        const MealForm = ({ meal, onSave, onCancel }) => {
            const [data, setData] = useState(meal || { name: '', time: '12:00', items: '', calories: 0, protein: 0, completed: false });

            return (
                <div className="modal">
                    <div className="modal-content">
                        <div className="flex flex-between mb-4">
                            <h2 className="text-xl">{meal ? 'Edit Meal' : 'Add Meal'}</h2>
                            <button className="icon-btn" onClick={onCancel}>‚úï</button>
                        </div>
                        <div>
                            <label className="text-sm mb-1" style={{ display: 'block' }}>Name</label>
                            <input type="text" value={data.name} onChange={e => setData({...data, name: e.target.value})} className="mb-4" />
                            
                            <label className="text-sm mb-1" style={{ display: 'block' }}>Time</label>
                            <input type="time" value={data.time} onChange={e => setData({...data, time: e.target.value})} className="mb-4" />
                            
                            <label className="text-sm mb-1" style={{ display: 'block' }}>Items</label>
                            <textarea value={data.items} onChange={e => setData({...data, items: e.target.value})} className="mb-4" style={{ minHeight: '5rem' }}></textarea>
                            
                            <div className="grid grid-2 gap-4 mb-4">
                                <div>
                                    <label className="text-sm mb-1" style={{ display: 'block' }}>Calories</label>
                                    <input type="number" value={data.calories} onChange={e => setData({...data, calories: parseInt(e.target.value) || 0})} />
                                </div>
                                <div>
                                    <label className="text-sm mb-1" style={{ display: 'block' }}>Protein (g)</label>
                                    <input type="number" value={data.protein} onChange={e => setData({...data, protein: parseInt(e.target.value) || 0})} />
                                </div>
                            </div>
                            
                            <div className="grid grid-2 gap-4">
                                <button className="btn btn-primary" onClick={() => data.name && data.items && onSave(data)}>Save</button>
                                <button className="btn btn-secondary" onClick={onCancel}>Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const WeightForm = ({ onSave, onCancel }) => {
            const [weight, setWeight] = useState('');

            return (
                <div className="modal">
                    <div className="modal-content">
                        <div className="flex flex-between mb-4">
                            <h2 className="text-xl">Log Weight</h2>
                            <button className="icon-btn" onClick={onCancel}>‚úï</button>
                        </div>
                        <label className="text-sm mb-1" style={{ display: 'block' }}>Weight (kg)</label>
                        <input type="number" step="0.1" value={weight} onChange={e => setWeight(e.target.value)} placeholder="105.0" style={{ fontSize: '1.5rem', textAlign: 'center' }} className="mb-4" />
                        <div className="grid grid-2 gap-4">
                            <button className="btn btn-primary" onClick={() => weight && parseFloat(weight) > 0 && (onSave(weight), onCancel())}>Save</button>
                            <button className="btn btn-secondary" onClick={onCancel}>Cancel</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
